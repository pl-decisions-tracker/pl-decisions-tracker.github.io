<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Daily stats from USC</title>
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="css/datatable-bootstrap.min.css" />
    <script type="text/javascript" src="js/datatable.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#">Stats</a>
        <div
          class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2"
          id="navbarNavAltMarkup"
        >
          <ul class="navbar-nav" id="navbarNav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"
                >Decisions</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="applications.html">Applications</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="statuses.html">Statuses</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <table
      id="decisionsTable"
      class="table"
      aria-describedby="Table of decisions by institutions and date"
    >
      <thead>
        <tr>
          <th>Date</th>
          <th>Who</th>
          <th>Case Type</th>
          <th>Decision</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="decisionsPagination" class="paging"></div>
    <script type="module">
      //import decisionsJson from "./decisions.json" assert { type: "json" };
      const decisionsJson = await (await fetch("decisions.json")).json();
      const institutions = await (await fetch("institution.json")).json();
      const caseTypes = await (await fetch("caseType.json")).json();
      const decisionMarkers = await (
        await fetch("./decisionMarker.json")
      ).json();
      let decisionsTable = document.getElementById("decisionsTable");

      let tableData = [];
      for (const day of Object.keys(decisionsJson).sort()) {
        for (const rec of decisionsJson[day]) {
          const inst = institutions.find((i) => i.id == rec.institution).name;
          const caset = caseTypes.find((ct) => ct.id == rec.caseType).type;
          const decm = decisionMarkers.find(
            (dm) => dm.id == rec.decisionMarker
          ).description;
          tableData.push([day, inst, caset, decm, rec.total]);
        }
      }

      var datatable = new DataTable(decisionsTable, {
        pageSize: 50,
        sort: "*",
        filters: [true, "select", "select", "select", false],
        data: tableData,
        pagingListClass: "pagination",
      });
      // patch
      // document.querySelectorAll("#decisionsPagination > * > li").forEach( li => li.classList.add("page-item"));
      // document.querySelectorAll("#decisionsPagination > * > li > a").forEach( a => a.classList.add("page-link"));
    </script>
  </body>
</html>
